/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var h=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}},n="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){if(a==Array.prototype||a==Object.prototype)return a;a[c]=d.value;return a},q=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var d=a[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");
},r=q(this),t=function(a,c){if(c)a:{var d=r;a=a.split(".");for(var b=0;b<a.length-1;b++){var e=a[b];if(!(e in d))break a;d=d[e]}a=a[a.length-1];b=d[a];c=c(b);c!=b&&null!=c&&n(d,a,{configurable:!0,writable:!0,value:c})}};
t("Symbol",function(a){if(a)return a;var c=function(g,f){this.g=g;n(this,"description",{configurable:!0,writable:!0,value:f})};c.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",b=0,e=function(g){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new c(d+(g||"")+"_"+b++,g)};return e});
t("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var c="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),d=0;d<c.length;d++){var b=r[c[d]];"function"===typeof b&&"function"!=typeof b.prototype[a]&&n(b.prototype,a,{configurable:!0,writable:!0,value:function(){return v(h(this))}})}return a});
var v=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a},w=function(a,c){a instanceof String&&(a+="");var d=0,b=!1,e={next:function(){if(!b&&d<a.length){var g=d++;return{value:c(g,a[g]),done:!1}}b=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};t("Array.prototype.keys",function(a){return a?a:function(){return w(this,function(c){return c})}});
var x="\" ' ( ) , - . / 0 1 2 : ? a about and are as be but com for from have i in is it like may more my next not of on search that the this to was when with you your".split(" "),y=!1,z={},A={},B=0,C=-1,D=-1,E=function(a){a=a.replace(/<[^>]*>/g,"");return a=a.replace(/[<>]/g,"")},F=function(a){a=E(a);return a=a.substring(0,100).toLowerCase()},G=function(a){for(var c=x.length,d=0;d<c;d++)if(a===x[d])return!0;return!1},H=function(a,c,d){"initialize"===a.type&&d({instanceId:B++})},I=function(a){"openOptionsPage"===
a.type&&chrome.tabs.create({url:chrome.runtime.getURL("options.html")})},J=function(a,c,d){"options"===a.type&&d({options:z})},M=function(a,c,d){if("fetch_raw"!==a.type&&"fetch_html"!==a.type)return!1;_gaq&&_gaq.push(["_trackEvent","lookup",a.type]);-1!==C&&D!==a.instanceId&&chrome.tabs.sendMessage(C,{type:"hide",instanceId:D});"fetch_raw"===a.type?(C=c.tab.id,D=a.instanceId):D=C=-1;var b=F(a.query),e=function(){var f={request:a,sanitizedQuery:b,dictExtResponse:null,isGetTabFailure:!1,tabLangDetectFailure:!1,
tabLangDetectTimedOut:!1,tabLang:null,callback:d,incognito:!1},k=window.setTimeout(function(){console.assert(null===f.dictExtResponse);f.tabLangDetectTimedOut=!0;K(b,"",function(l){f.dictExtResponse=l;L(f)})},800);chrome.tabs.getSelected(null,function(l){f.incognito=l.incognito;chrome.tabs.detectLanguage(l.id,function(p){f.tabLangDetectTimedOut||(window.clearTimeout(k),"und"!==p?(f.tabLang="he"===p?"iw":p,K(b,f.tabLang,function(m){f.dictExtResponse=m;L(f)})):(f.tabLangDetectFailure=!0,K(b,"",function(m){f.dictExtResponse=
m;L(f)})))})})};if(y)e();else{var g=function(f){if(y)return e();if(10<f)return d({eventKey:a.eventKey,sanitizedQuery:b});window.setTimeout(function(){g(f+1)},200)};g(0)}return!0},K=function(a,c,d){var b=z.language,e=b;"en-uk"==b&&(e="en");var g=window["gdx.LANG_TO_CORPUS"][b];g||(g=b);a={path:"v1/dictionaryExtensionData",params:{term:a,language:e,corpus:g,strategy:2}};(g=window["gdx.CORPUS_TO_COUNTRY"][g])&&(a.params.country=g);c&&(a.params.tab_language=c);gapi.client.request(a).execute(function(f){var k=
f.status;k&&200!=k?d(null):d(f)})},N=function(a,c){var d=null;c&&"true"===z.storeHistory&&!a.incognito&&chrome.storage.local.get("word-history",function(e){d=c.srcLang+"<"+z.language+"<"+a.sanitizedQuery;e["word-history"][d]=c.meaningText;chrome.storage.local.set(e)});c&&!c.prettyQuery&&(c.prettyQuery=a.sanitizedQuery);var b=!1;("true"===z.popupDblclick&&"none"===z.popupDblclickKey||"true"===z.popupSelect&&"none"===z.popupSelectKey)&&G(a.sanitizedQuery)&&(b=!0);a.callback({eventKey:a.request.eventKey,
sanitizedQuery:a.sanitizedQuery,meaningObj:c,showOptionsTip:b})},L=function(a){var c=a.dictExtResponse,d="none",b=null;if(c&&200===c.status&&c.translateResponse)d="translation",a.preferTran=!0,a.translateResponse=c.translateResponse,(b=O(c.translateResponse,!0))&&c.oxfordAudio&&(b.audio=P(c.oxfordAudio));else if(c&&200===c.status&&c.dictionaryData){d="definition";a.dictResponse=c.dictionaryData[0];var e=a.dictResponse;if(!e||e.error)b=null;else{b=null;if(c=Q(e,"entries[0]"))b={prettyQuery:c.syllabifiedHeadword||
c.headword,meaningText:Q(c,"senseFamilies[0].senses[0].definition.text"),attribution:"",audio:Q(c,"phonetics[0].oxfordAudio"),type:"licensedDef"},b.meaningText?b.audio&&(b.audio=P(b.audio)):b=null;!b&&(c=Q(e,"webDefinitions[0]"))&&(b=c.sourceUrl,b={meaningText:c.definition,attribution:'<a href="'+b+'">'+b+"</a>",type:"webDef"});b?(c=b.meaningText,b.meaningText=c.charAt(0).toUpperCase()+c.slice(1)):b=null}}b||(d="none");_gaq&&_gaq.push(["_trackEvent","lookup","type_"+d]);e=encodeURIComponent(a.sanitizedQuery);
var g=c="";if("translation"===d)c="https://translate.google.com/translate_t?source=dict-chrome-ex&sl="+b.srcLang+"&tl="+z.language+"&q="+e,b.moreUrl=c;else if("definition"===d){g=z.language;var f=(f=window["gdx.LANG_TO_DEFINE"][g])?f.replace("${term}",e):"";var k=window["gdx.LANG_TO_CORPUS"][z.language];k||(k=z.language);e="https://www.google.com/search?dictcorpus="+k+"&hl="+g+"&forcedict="+e+"&q="+f;"en-uk"===g&&(e+="&gl=gb");g=e;b.moreUrl=g}"fetch_html"===a.request.type?(f="",b&&(f=b.audio),e=a.dictResponse,
d=a.translateResponse,b=f,a.preferTran?(e=O(d,!1))?(b&&(e.audio=b),d.tranResSummary=e,d.moreUrl=c,d.dict=d.bilingualDictionary,d.hasDict=!!d.dict&&d.dict.length,d=A.browser_action_tran(d)):d="":d=R(e,g),a.callback({eventKey:a.request.eventKey,sanitizedQuery:a.sanitizedQuery,html:d})):("definition"===d&&(b.srcLang=z.language),N(a,b))},O=function(a,c){if(!a||!a.translateText||0===a.translateText.length)return null;var d=a.sourceText.toLowerCase(),b=a.translateText.toLowerCase();if(c){c=a.bilingualDictionary;
var e=b;if(c)for(var g=c.length,f=0;f<g;f++)for(var k=c[f],l=0,p=k.terms.length,m=0;m<p&&2>l;m++){var u=k.terms[m].toLowerCase();0<u.length&&u!==d&&u!==b&&(e+=", "+u,l++)}d=E(e)}else d=b;a=a.detectedSourceLanguage;(b=window["gdx.LANG_TO_NAME"][a.toLowerCase()])||(b=a);return{type:"translation",meaningText:d,attribution:"Translated from "+b,srcLang:a}},Q=function(a,c){c=c.split(".");for(var d=0;d<c.length;d++){var b=c[d];console.assert(b);if("]"===b.charAt(b.length-1)){b=b.split("[");console.assert(2===
b.length);var e=parseInt(b[1].slice(0,-1),10);a=a[b[0]];if(!a)return null;a=a[e]}else a=a[b];if(!a)return null}return a},P=function(a){return"//"===a.substr(0,2)?"https:"+a:a},R=function(a,c){if(!a||a.error)return"";a.moreUrl=c;a.makeAudioUrl=function(){var b=this.oxfordAudio;return b?P(b):""};var d={};a.showOnlyOnce=function(){return function(b,e){b=e(b);if(d[b])return"";d[b]=!0;return b}};return A.browser_action_dict(a)},S=function(a){var c={};c.language=a.language||"en";var d=function(e,g){var f=
a[e];c[e]=g;"true"===f||"false"===f?c[e]=f:"boolean"===typeof f&&(c[e]=String(f))},b=function(e,g){c[e]=a[e]||g};d("popupDblclick","true");d("popupSelect","false");d("enableHttps","true");b("popupDblclickKey","none");b("popupSelectKey","ctrl");d("storeHistory","false");d("allowCrossExtensionHistory","false");"pt"===a.language&&(c.language="pt-BR");return c},T=function(a,c,d){if("false"===z.allowCrossExtensionHistory||"false"===z.storeHistory||!a||!a.getHistory)return!1;chrome.storage.local.get("word-history",
function(b){d(b["word-history"])});return!0},U=function(a,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.onload=function(){var b=null;200===this.status&&(b=d.response);return c(b)};d.send()},V=function(){var a=window.localStorage.options,c={};a&&(c=JSON.parse(a));z=S(c);window.localStorage.options=JSON.stringify(z);chrome.storage.local.get("word-history",function(d){d["word-history"]||chrome.storage.local.set({"word-history":{}})});chrome.runtime.onMessage.addListener(H);chrome.runtime.onMessage.addListener(I);
chrome.runtime.onMessage.addListener(J);chrome.runtime.onMessage.addListener(M);chrome.runtime.onMessageExternal.addListener(T)};window["gdx.updateOptions"]=function(){z=JSON.parse(window.localStorage.options)};
window.initBackgroundPageAsync=function(a){gapi.config.update("googleapis.config/root","https://dictionaryextension-pa.googleapis.com");gapi.client.setApiKey("AIzaSyA6EEtrDCfBkHV8uU2lgGY-N383ZgAOo7Y");var c=function(){2>Object.keys(A).length||(y=!0,a&&a())},d=function(b){Mustache.parse(b);return function(e){return Mustache.render(b,e)}};U("templates/browser_action_dict.html",function(b){A.browser_action_dict=d(b);c()});U("templates/browser_action_tran.html",function(b){A.browser_action_tran=d(b);
c()})};window.initBackgroundPage=V;var W=W||!1;W||V();})();